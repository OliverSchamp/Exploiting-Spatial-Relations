"""
CODE FOR READING LOG FILE AFTER DETR RUNS. DATAFRAME GRAPHS BELOW

To run this code:
python RetinaNet/read_csvs.py --csv_path RetinaNet/retinanet_output/val.csv --out_path RetinaNet/experiments_figs/4classes_val_retinanet.png
python RetinaNet/read_csvs.py --csv_path RetinaNet/retinanet_output/val_pos.csv --out_path RetinaNet/experiments_figs/14classes_val_retinanet.png

"""


import os
import json
import pandas as pd
import matplotlib.pyplot as plt
import argparse
import numpy as np


def get_args_parser():
    parser = argparse.ArgumentParser('Set transformer detector', add_help=False)

    parser.add_argument('--csv_path', default='', type=str,
                        help='path to the csv file')

    parser.add_argument('--out_path', default='', type=str,
                        help='path to write the graph to')

    return parser

if __name__ == "__main__":
    parser = argparse.ArgumentParser('Read from logs file', parents=[get_args_parser()])
    args = parser.parse_args()
    file_path = args.csv_path


    df = pd.read_csv(file_path).dropna()
    # df.set_index('Epoch', inplace=True)
    df.index = np.arange(len(df))

    for col in df.columns:
        if col in ['MAP 0.5:95 small 100',
              'MAP 0.5:95 medium 100', 'MAP 0.5:95 large 100']:
            plt.plot(df.index, df[col], label=col)
            # plt.xlabel("Epochs")
            # plt.ylabel(col)
            # plt.title("Learning rate against epochs")
            # plt.savefig("../ReportFigs/learning_rate.png", bbox_inches="tight")
    plt.xlabel("Epochs")
    plt.ylabel('')
    plt.title("Evaluation of RetinaNet on the validation set")
    plt.legend(loc="lower right")
    plt.savefig(args.out_path, bbox_inches="tight")